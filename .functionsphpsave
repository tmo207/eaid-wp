// ADD ACF OPTIONS PAGE
if( function_exists('acf_add_options_page') ) {
	
    acf_add_options_page();
    
	acf_add_options_sub_page('Footer');
	
}

// Change WP-JSON route
add_filter( 'rest_url_prefix', 'rest_url_prefix' );
 
function rest_url_prefix( ) {
  return 'zzUbVKD3ckNW/index.php/wp-json';
}

// Add pingbacks to wp JSON
function getPingbacks() {
  $comments = get_comments();
  $pings = array();

  foreach ( $comments as $comment ) :
           if ($comment->comment_type == 'pingback' or $comment->comment_type == 'trackback' ) {
         array_push($pings, $comment);
           }
   endforeach; 

 
  return $pings;
}

add_action( 'rest_api_init', function () {
  register_rest_route( 'wp/mypings', '/pingbacks', array(
    'methods' => 'GET',
    'callback' => 'getPingbacks',
  ) );
} );

// Encrypt acf emails
add_filter('acf/load_value', 'eae_encode_emails');

// Encrypt acf emails
add_filter('acf/load_value', 'eae_encode_emails');

// Prevent hyperlink flickering in acf fields
add_action('admin_head', 'prevent_link_flickering');

function prevent_link_flickering() {
	$current = get_current_screen();
if ( $current->post_type == 'page' &&  $current->base == 'post') {
echo '<style>
    #wpwrap {
      height: 101%;
    } 
  </style>';
    }
}

// Allow anonymous comments
function filter_rest_allow_anonymous_comments() {
    return true;
}
add_filter('rest_allow_anonymous_comments','filter_rest_allow_anonymous_comments');

// Make sure build is successful when no post has image
function nullify_empty($value, $post_id, $field)
{
    if (empty($value)) {
        return null;
    }

    return $value;
}

add_filter('acf/format_value', 'nullify_empty', 100, 3);